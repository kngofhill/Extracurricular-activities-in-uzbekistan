<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EC Platform Uzbekistan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { padding: 2rem; background-color: #f0f8ff; }
    .card { margin-top: 1rem; }
    .hide { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center">EC Platform Uzbekistan</h1>

    <!-- Auth Section -->
    <div id="auth-section">
      <h3>Register / Login</h3>
      <input id="email" class="form-control" placeholder="Email" type="email">
      <input id="password" class="form-control mt-2" placeholder="Password" type="password">
      <button id="registerBtn" class="btn btn-primary mt-2">Register</button>
      <button id="loginBtn" class="btn btn-success mt-2">Login</button>
      <button id="logoutBtn" class="btn btn-danger mt-2 hide">Logout</button>
    </div>
  <!-- Filter Section -->
<div id="filter-section" class="mt-4">
  <h3>Filter Listings</h3>
  <div class="d-flex flex-column flex-md-row gap-2">
    <select id="filter-location" class="form-control">
      <option value="">All Locations</option>
      <option>Andijan</option><option>Fergana</option><option>Tashkent</option>
      <option>Samarkand</option><option>Bukhara</option><option>Namangan</option>
      <option>Khorezm</option><option>Karakalpakstan</option><option>Jizzakh</option>
      <option>Kashkadarya</option><option>Surkhandarya</option><option>Syrdarya</option>
      <option>Navoi</option><option>Gulistan</option>
    </select>
    <select id="filter-field" class="form-control">
      <option value="">All Fields</option>
      <option>STEM</option><option>Business</option><option>Art</option>
      <option>Leadership</option><option>Debate</option><option>Writing</option>
    </select>
    <button id="filterBtn" class="btn btn-info">Filter</button>
  </div>
</div>


    <!-- Listings -->
    <div id="listings" class="mt-4"></div>
  </div>
    <!-- Post Form -->
    <!-- Post Section (button) -->
<div id="post-section" class="hide">
  <h3 class="mt-4">Create an EC Listing</h3>
  <button class="btn btn-success my-3" onclick="showCreateForm()">I want to post an EC opportunity</button>

  <!-- This form will be hidden initially -->
  <div id="createListingSection" style="display: none;">
    <select id="location" class="form-control">
      <option disabled selected>Choose location</option>
      <option>Andijan</option><option>Fergana</option><option>Tashkent</option>
      <option>Samarkand</option><option>Bukhara</option><option>Namangan</option>
      <option>Khorezm</option><option>Karakalpakstan</option><option>Jizzakh</option>
      <option>Kashkadarya</option><option>Surkhandarya</option><option>Syrdarya</option>
      <option>Navoi</option><option>Gulistan</option>
    </select>
    <select id="field" class="form-control mt-2">
      <option disabled selected>Choose field of EC</option>
      <option>STEM</option><option>Business</option><option>Art</option>
      <option>Leadership</option><option>Debate</option><option>Writing</option>
    </select>
    <select id="type" class="form-control mt-2">
      <option disabled selected>Choose type of EC</option>
      <option>Competition</option><option>Internship</option><option>Volunteering</option>
      <option>Online Course</option><option>Workshop</option><option>Club</option>
    </select>
    <input id="telegram" class="form-control mt-2" placeholder="Telegram Username (e.g. @myusername)" />
    <input id="title" class="form-control mt-2" placeholder="Title" />
    <textarea id="desc" class="form-control mt-2" placeholder="Description"></textarea>
    <button id="submitBtn" class="btn btn-warning mt-2">Post</button>
  </div>
</div>


    <!-- Toast Notification -->
    <div id="postToast" class="toast position-fixed bottom-0 end-0 m-3 align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          âœ… Post submitted successfully!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>

  

<script>
function showCreateForm() {
  const user = auth.currentUser;
  if (!user) {
    alert("Please register or log in to post an opportunity.");
    return;
  }
  const section = document.getElementById("createListingSection");
  section.style.display = "block";
  section.scrollIntoView({ behavior: "smooth" });
}


  const firebaseConfig = {
    apiKey: "AIzaSyD__OINWiM7cLVx0pGsT3kBbZxrjBm23c0",
    authDomain: "extracurricularsuzbekistan.firebaseapp.com",
    databaseURL: "https://extracurricularsuzbekistan-default-rtdb.firebaseio.com",
    projectId: "extracurricularsuzbekistan",
    storageBucket: "extracurricularsuzbekistan.firebasestorage.app",
    messagingSenderId: "555521664728",
    appId: "1:555521664728:web:bf72cb8384be98ff7b99ad",
    measurementId: "G-Z53076ZBCJ"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const email = document.getElementById('email');
  const password = document.getElementById('password');
  const registerBtn = document.getElementById('registerBtn');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const submitBtn = document.getElementById('submitBtn');
  const filterBtn = document.getElementById('filterBtn');

  const authSection = document.getElementById('auth-section');
  const postSection = document.getElementById('post-section');
  const filterSection = document.getElementById('filter-section');
  const listings = document.getElementById('listings');

  function showToast() {
    const toast = new bootstrap.Toast(document.getElementById("postToast"));
    toast.show();
  }

  // REGISTER
  registerBtn.onclick = () => {
    auth.createUserWithEmailAndPassword(email.value, password.value)
      .then(() => alert('Registered successfully'))
      .catch(e => alert(e.message));
  };

  // LOGIN
  loginBtn.onclick = () => {
    auth.signInWithEmailAndPassword(email.value, password.value)
      .catch(e => alert(e.message));
  };

  // LOGOUT
  logoutBtn.onclick = () => {
    auth.signOut();
  };

  // AUTH STATE LISTENER
auth.onAuthStateChanged(user => {
  if (user) {
    authSection.classList.add('hide');
    postSection.classList.remove('hide');
    logoutBtn.classList.remove('hide');
  } else {
    authSection.classList.remove('hide');
    postSection.classList.add('hide');
    logoutBtn.classList.add('hide');
  }
  // Always show filters regardless of auth state
  filterSection.classList.remove('hide');
});


  // SUBMIT POST
  submitBtn.onclick = () => {
    const loc = document.getElementById('location').value;
    const field = document.getElementById('field').value;
    const type = document.getElementById('type').value;
    const title = document.getElementById('title').value;
    const desc = document.getElementById('desc').value;
    const telegram = document.getElementById("telegram").value.trim();

    if (!title || !desc || !loc || !field || !type) return alert('Fill all fields');

    const newPostRef = db.ref('posts').push();
    newPostRef.set({
      title,
      desc,
      location: loc,
      field,
      type,
      telegram,
      uid: auth.currentUser.uid
    }).then(() => {
      showToast();
    }).catch(err => {
      alert("Failed to post: " + err.message);
    });
  };

  // FILTER POSTS
  filterBtn.onclick = () => {
    const fLoc = document.getElementById('filter-location').value;
    const fField = document.getElementById('filter-field').value;

    db.ref('posts').once('value', snapshot => {
      listings.innerHTML = '';
      let found = false;
      snapshot.forEach(child => {
        const post = child.val();
        if ((fLoc === '' || post.location === fLoc) && (fField === '' || post.field === fField)) {
          found = true;
          listings.innerHTML += `
            <div class="card">
              <div class="card-body">
                <h5>${post.title}</h5>
                <p>${post.desc}</p>
                <p><strong>${post.field}</strong> - ${post.type}, ${post.location}</p>
                <p><strong>Telegram:</strong> ${post.telegram || "N/A"}</p>
              </div>
            </div>`;
        }
      });
      if (!found) {
        listings.innerHTML = `<p class="text-muted mt-3">No opportunities match your filters. Please try again later.</p>`;
      }
    });
  };
</script>

</body>
</html>






