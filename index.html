<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EC Portal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; }
    .hidden { display: none; }
    input, select, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
    }
    #logoutBtn { background: red; color: white; }
    #message { color: red; text-align: center; }
    #projectList { margin-top: 20px; }
    .project {
      background: #e7f5ff;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>EC Portal</h2>

    <div id="authSection">
      <h3>Register</h3>
      <input type="email" id="registerEmail" placeholder="Email">
      <input type="password" id="registerPassword" placeholder="Password">
      <button onclick="register()">Register</button>

      <h3>Login</h3>
      <input type="email" id="loginEmail" placeholder="Email">
      <input type="password" id="loginPassword" placeholder="Password">
      <button onclick="login()">Login</button>
      <p id="message"></p>
    </div>

    <div id="appSection" class="hidden">
      <button id="logoutBtn" onclick="logout()">Logout</button>

      <h3>Post an EC Project</h3>
      <select id="location">
        <option value="">Select City</option>
        <option value="Tashkent">Tashkent</option>
        <option value="Andijan">Andijan</option>
        <option value="Namangan">Namangan</option>
        <option value="Fergana">Fergana</option>
        <option value="Bukhara">Bukhara</option>
        <option value="Samarkand">Samarkand</option>
        <option value="Navoi">Navoi</option>
        <option value="Kokand">Kokand</option>
        <option value="Urgench">Urgench</option>
        <option value="Nukus">Nukus</option>
      </select>
      <select id="type">
        <option value="">Select Type</option>
        <option value="Volunteering">Volunteering</option>
        <option value="Afterschool Club">Afterschool Club</option>
        <option value="Outdoor Activity">Outdoor Activity</option>
        <option value="Research">Research</option>
        <option value="Startup">Startup</option>
      </select>
      <select id="theme">
        <option value="">Select Theme</option>
        <option value="Computer Science">Computer Science</option>
        <option value="Psychology">Psychology</option>
        <option value="Art">Art</option>
        <option value="Business">Business</option>
        <option value="Biology">Biology</option>
        <option value="Engineering">Engineering</option>
      </select>
      <input type="text" id="contact" placeholder="Contact info (phone/email/Telegram)">
      <button onclick="postProject()">Post Project</button>

      <h3>Search Projects</h3>
      <select id="searchCity"></select>
      <select id="searchType"></select>
      <select id="searchTheme"></select>
      <button onclick="searchProjects()">Search</button>

      <div id="projectList"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const message = document.getElementById('message');

    auth.onAuthStateChanged(user => {
      if (user) {
        authSection.classList.add('hidden');
        appSection.classList.remove('hidden');
        populateSearchFilters();
      } else {
        authSection.classList.remove('hidden');
        appSection.classList.add('hidden');
      }
    });

    function register() {
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      auth.createUserWithEmailAndPassword(email, password).catch(e => {
        message.textContent = e.message;
      });
    }

    function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      auth.signInWithEmailAndPassword(email, password).catch(e => {
        message.textContent = "Incorrect email or password.";
      });
    }

    function logout() {
      auth.signOut();
    }

    function postProject() {
      const uid = auth.currentUser.uid;
      const location = document.getElementById('location').value;
      const type = document.getElementById('type').value;
      const theme = document.getElementById('theme').value;
      const contact = document.getElementById('contact').value;
      const postData = { uid, location, type, theme, contact };
      db.ref('projects').push(postData);
      alert('Project Posted!');
    }

    function populateSearchFilters() {
      const cities = ["Tashkent","Andijan","Namangan","Fergana","Bukhara","Samarkand","Navoi","Kokand","Urgench","Nukus"];
      const types = ["Volunteering","Afterschool Club","Outdoor Activity","Research","Startup"];
      const themes = ["Computer Science","Psychology","Art","Business","Biology","Engineering"];

      const fillOptions = (select, items) => {
        select.innerHTML = '<option value="">Any</option>' + items.map(i => `<option value="${i}">${i}</option>`).join('');
      }
      fillOptions(document.getElementById('searchCity'), cities);
      fillOptions(document.getElementById('searchType'), types);
      fillOptions(document.getElementById('searchTheme'), themes);
    }

    function searchProjects() {
      const city = document.getElementById('searchCity').value;
      const type = document.getElementById('searchType').value;
      const theme = document.getElementById('searchTheme').value;

      db.ref('projects').once('value', snapshot => {
        const list = document.getElementById('projectList');
        list.innerHTML = '';
        snapshot.forEach(child => {
          const data = child.val();
          if ((city === '' || data.location === city) &&
              (type === '' || data.type === type) &&
              (theme === '' || data.theme === theme)) {
            const div = document.createElement('div');
            div.className = 'project';
            div.innerHTML = `<strong>${data.type}</strong> in ${data.location} - ${data.theme}<br>Contact: ${data.contact}`;
            list.appendChild(div);
          }
        });
      });
    }
  </script>
</body>
</html>
